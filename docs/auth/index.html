<!DOCTYPE html>
<html>
    <head><script src="//archive.org/includes/analytics.js?v=cf34f82" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app39.us.archive.org';v.server_ms=386;archive_analytics.send_pageview({});});</script><script type="text/javascript" src="/static/js/wbhack.js?v=1522452177.0" charset="utf-8"></script>

<script type="text/javascript">
__wbhack.init('https://web.archive.org/web');
</script>
<link rel="stylesheet" type="text/css" href="/static/css/banner-styles.css?v=1522452177.0" />
<link rel="stylesheet" type="text/css" href="/static/css/iconochive.css?v=1522452177.0" />

<!-- End Wayback Rewrite JS Include -->
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Horizon authentication</title>

        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/github.css">

        <link rel="icon" type="image/png" href="/favicon/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96">
        <link rel="icon" type="image/png" href="/favicon/favicon-16x16.png" sizes="16x16">
        <link rel="shortcut icon" href="/favicon/favicon.ico">

        <!-- fonts.com -->
        <script type="text/javascript">
            // first, create the object that contains
            // configuration variables
            MTIConfig = {};

            // next, add a variable that will control
            // whether or not FOUT will be prevented
            MTIConfig.EnableCustomFOUTHandler = false // true = prevent FOUT
        </script>
        <script type="text/javascript" src="//web.archive.org/web/20171013233348js_/http://fast.fonts.net/jsapi/5cf5064a-b80d-4123-82d3-5c7a863edb22.js"></script>
        <!-- jquery -->
        <script type="text/javascript" src="/js/jquery/jquery-2.2.3.min.js"></script>
        <!-- waypoints -->
        <script type="text/javascript" src="/js/waypoints/jquery.waypoints.min.js"></script>
        <script type="text/javascript" src="/js/waypoints/sticky.min.js"></script>
        <!-- horizon.io -->
        <script type="text/javascript" src="/js/site.js"></script>
    </head>
    <body>
        

        <nav class="site-nav">
            <div class="site-container">
                <a class="logo" href="/"><img src="/images/horizon-logo.png" alt="Horizon"></a>
                <ul class="navbar-links">
                    <li class="menu-trigger">
                        <svg height="24px" version="1.1" viewbox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" xmlns:xlink="http://www.w3.org/1999/xlink"><title/><desc/><defs/><g fill="none" fill-rule="evenodd" id="miu" stroke="none" stroke-width="1"><g id="Artboard-1" transform="translate(-395.000000, -479.000000)"><g id="slice" transform="translate(215.000000, 119.000000)"/><path d="M396.500836,485 C396.224232,485 396,485.214035 396,485.504684 L396,486.495316 C396,486.774045 396.217742,487 396.500836,487 L417.499164,487 C417.775768,487 418,486.785965 418,486.495316 L418,485.504684 C418,485.225955 417.782258,485 417.499164,485 L396.500836,485 Z M396.500836,490 C396.224232,490 396,490.214035 396,490.504684 L396,491.495316 C396,491.774045 396.217742,492 396.500836,492 L417.499164,492 C417.775768,492 418,491.785965 418,491.495316 L418,490.504684 C418,490.225955 417.782258,490 417.499164,490 L396.500836,490 Z M396.500836,495 C396.224232,495 396,495.214035 396,495.504684 L396,496.495316 C396,496.774045 396.217742,497 396.500836,497 L417.499164,497 C417.775768,497 418,496.785965 418,496.495316 L418,495.504684 C418,495.225955 417.782258,495 417.499164,495 L396.500836,495 Z" id="editor-list-view-hambuger-menu-glyph"/></g></g></svg>

                    </li>
                    <li>
                        <a href="/cloud">Horizon Cloud</a>
                    </li>
                    <li>
                        <a href="/install">Install</a>
                    </li>
                    <li>
                        <a href="/faq">FAQ</a>
                    </li>
                    <li class="active">
                        <a href="/docs">Docs</a>
                    </li>
                    <li>
                        <a href="/community">Community</a>
                    </li>
                    <li>
                        <a href="/blog">Blog</a>
                    </li>
                </ul>
            </div>
        </nav>
        <section class="site-content">
            <section class="documentation">
    <div class="site-container">
        <nav class="docs-nav">
            
            <section>
                <h1>Horizon basics</h1>
                <ul>
                    
                        <li>
                            <!-- index | auth -->
                            <a href="/docs">Overview</a>
                        </li>
                    
                        <li>
                            <!-- install | auth -->
                            <a href="/install">Install Horizon</a>
                        </li>
                    
                        <li>
                            <!-- faq | auth -->
                            <a href="/faq">FAQ</a>
                        </li>
                    
                        <li>
                            <!-- getting-started | auth -->
                            <a href="/docs/getting-started">Getting started</a>
                        </li>
                    
                </ul>
            </section>
            
            <section>
                <h1>Building Horizon apps</h1>
                <ul>
                    
                        <li>
                            <!-- cli | auth -->
                            <a href="/docs/cli">Horizon CLI</a>
                        </li>
                    
                        <li class="active">
                            <!-- auth | auth -->
                            <a href="/docs/auth">Authentication</a>
                        </li>
                    
                        <li>
                            <!-- users | auth -->
                            <a href="/docs/users">Users and groups</a>
                        </li>
                    
                        <li>
                            <!-- permissions | auth -->
                            <a href="/docs/permissions">Permissions</a>
                        </li>
                    
                        <li>
                            <!-- api-collection | auth -->
                            <a href="/api/collection">Collection API</a>
                        </li>
                    
                        <li>
                            <!-- api-horizon | auth -->
                            <a href="/api/horizon">Horizon API</a>
                        </li>
                    
                </ul>
            </section>
            
            <section>
                <h1>Resources</h1>
                <ul>
                    
                        <li>
                            <!-- config | auth -->
                            <a href="/docs/configuration">Configuring Horizon</a>
                        </li>
                    
                        <li>
                            <!-- embed | auth -->
                            <a href="/docs/embed">Embedding Horizon</a>
                        </li>
                    
                        <li>
                            <!-- examples | auth -->
                            <a href="/docs/examples">Example apps</a>
                        </li>
                    
                        <li>
                            <!-- limitations | auth -->
                            <a href="/docs/limitations">Limitations</a>
                        </li>
                    
                        <li>
                            <!-- docker | auth -->
                            <a href="/docs/docker">Horizon with Docker</a>
                        </li>
                    
                </ul>
            </section>
            
        </nav>
        <section class="docs-article document">
            
            <h1 class="title">Horizon authentication</h1>
            <p>Horizon uses <a href="https://web.archive.org/web/20171013233348/https://jwt.io/">JSON Web Tokens</a> for user authentication, an <a href="https://web.archive.org/web/20171013233348/https://tools.ietf.org/html/rfc7519" title="RFC 7519: JSON Web Token (JWT)">open industry standard</a>. Depending on your application, you can choose one of three types of authentication handling by passing the <code class="highlighter-rouge">authType</code> option to the <a href="/api/horizon/#constructor">Horizon object constructor</a>.</p>

<ul>
  <li><code class="highlighter-rouge">unauthenticated</code>: do not generate a web token, and do not create entries in the Horizon user table. This essentially bypasses Horizon’s authentication system, and is best for applications that don’t need to store any user data.</li>
  <li><code class="highlighter-rouge">anonymous</code>: generate a unique token for each new user, and create an entry in the users table for the generated token. This allows authentication through the generated token, which is stored client-side in <a href="https://web.archive.org/web/20171013233348/https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">localStorage</a>.</li>
  <li><code class="highlighter-rouge">token</code>: verify a user’s identify via a third-party <a href="https://web.archive.org/web/20171013233348/http://oauth.net/">OAuth</a> service provider. As with <code class="highlighter-rouge">anonymous</code>, the returned JWT will be stored client-side.</li>
</ul>

<p>You may also pass an already-created JWT to <code class="highlighter-rouge">authType</code>; this is useful for bootstrapping the admin user, or for integrating with non-browser-based authentication methods. Read “Making an admin auth token” in <a href="/docs/permissions/#admin">Permissions and schema enforcement</a> for more details.</p>

<h1 id="using-local-authentication">Using local authentication</h1>

<div class="infobox">
  <p>Note that Horizon does <em>not</em> have any “baked-in” local user/password authentication. The only fully-supported authentication method for individual user accounts is OAuth through a third-party provider.</p>
</div>

<h2 id="unauthenticated">Unauthenticated</h2>

<p>The first auth type is unauthenticated. This creates no web token, and Horizon does no user management whatsoever. To create a connection using the ‘unauthenticated’ method do:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">horizon</span> <span class="o">=</span> <span class="nx">Horizon</span><span class="p">({</span> <span class="na">authType</span><span class="p">:</span> <span class="s1">'unauthenticated'</span> <span class="p">});</span>
</code></pre>
</div>

<p>This is the default authentication method and provides no means to separate user permissions or data in the Horizon application.</p>

<h2 id="anonymous">Anonymous</h2>

<p>The second auth type is anonymous. If anonymous authentication is enabled in the config, any user requesting anonymous authentication will be given a new JWT, with no other confirmation necessary. The server will create a user entry in the users table for this token, with no other way to authenticate as this user than by passing the token back. (This is done “under the hood,” with the JWT stored in localStorage and passed back automatically on subsequent requests.)</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">horizon</span> <span class="o">=</span> <span class="nx">Horizon</span><span class="p">({</span> <span class="na">authType</span><span class="p">:</span> <span class="s1">'anonymous'</span> <span class="p">});</span>
</code></pre>
</div>

<p>In effect, this authentication type creates a “temporary user” for use with the current session. This allows user information to be saved while that session is active, but the user has no way of reauthenticating with the same account if the token is lost. (Note that the temporary user ID is stored in the Horizon database, and must be cleaned up manually.)</p>

<h1 id="oauth">Using OAuth</h1>

<p>Your application will need a client ID and “secret” for each OAuth provider you want to connect with. The providers Horizon currently supports are:</p>

<ul>
  <li><a href="https://web.archive.org/web/20171013233348/https://developers.facebook.com/apps/">Facebook</a></li>
  <li><a href="https://web.archive.org/web/20171013233348/https://github.com/settings/applications/new">Github</a></li>
  <li><a href="https://web.archive.org/web/20171013233348/https://console.developers.google.com/project">Google</a></li>
  <li><a href="https://web.archive.org/web/20171013233348/https://api.slack.com/apps">Slack</a></li>
  <li><a href="https://web.archive.org/web/20171013233348/https://www.twitch.tv/kraken/oauth2/clients/new">Twitch</a></li>
  <li><a href="https://web.archive.org/web/20171013233348/https://apps.twitter.com/app/new">Twitter</a></li>
  <li><a href="https://web.archive.org/web/20171013233348/https://auth0.com/">Auth0</a></li>
</ul>

<p>Each provider will let you register your application, and will give you the client data you need to give Horizon.</p>

<h2 id="configuring-the-server">Configuring the server</h2>

<p>In order to use OAuth with Horizon, you’ll need to configure a TLS certificate so you can serve assets with HTTPS, and either specify the <code class="highlighter-rouge">--key-file</code> and <code class="highlighter-rouge">--cert-file</code> options to <code class="highlighter-rouge">hz serve</code> or add them to the server’s <code class="highlighter-rouge">.hz/config.toml</code> file. (See <a href="/docs/configuration">The config.toml file</a> for more details.) You can create a self-signed certificate with <code class="highlighter-rouge">hz create-cert</code>.</p>

<p>You’ll need to enter <code class="highlighter-rouge">id</code> and <code class="highlighter-rouge">secret</code> values in the <code class="highlighter-rouge">.hz/secrets.toml</code> file for your server (along with <code class="highlighter-rouge">host</code> and <code class="highlighter-rouge">redirect_url</code> values for Auth0). Toward the bottom of the automatically generated file, you’ll see commented-out sample settings. Uncomment the appropriate lines and replace the dummy values with the ones you’ve received from the application provider. Adding Github OAuth configuration data would look like this:</p>

<div class="language-toml highlighter-rouge"><pre class="highlight"><code><span class="c"># [auth.facebook]</span>
<span class="c"># id = "000000000000000"</span>
<span class="c"># secret = "00000000000000000000000000000000"</span>
<span class="c">#</span>
<span class="c"># [auth.google]</span>
<span class="c"># id = "00000000000-00000000000000000000000000000000.apps.googleusercontent.com"</span>
<span class="c"># secret = "000000000000000000000000"</span>
<span class="c">#</span>
<span class="c"># [auth.twitter]</span>
<span class="c"># id = "0000000000000000000000000"</span>
<span class="c"># secret = "00000000000000000000000000000000000000000000000000"</span>

<span class="nn">[auth.github]</span>
<span class="py">id</span> <span class="p">=</span> <span class="s">"your_client_id"</span>
<span class="py">secret</span> <span class="p">=</span> <span class="s">"your_client_secret"</span>
</code></pre>
</div>

<p>Verify the configuration by running <code class="highlighter-rouge">hz serve</code> and browsing to <code class="highlighter-rouge">https://localhost:8181/horizon/auth_methods</code>. (If you’re not running on your local machine, change the server name and port as appropriate.) You’ll see a list of currently active authentication options. For our example, you should see <code class="highlighter-rouge">github</code> included in the available auth methods object:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="p">{</span>
  <span class="nl">github</span><span class="p">:</span> <span class="s2">"/horizon/github"</span>
<span class="p">}</span>
</code></pre>
</div>

<p>If instead you only see empty brackets (e.g., <code class="highlighter-rouge"><span class="p">{</span><span class="w"> </span><span class="p">}</span></code>), ensure you’ve restarted the Horizon server, and that it’s using the <code class="highlighter-rouge">.hz/config.toml</code> file you’ve edited.</p>

<p><strong>Note:</strong> If your application embeds Horizon rather than using <code class="highlighter-rouge">hz serve</code>, you’ll need to pass the OAuth endpoint to that object. Read “Configuring OAuth providers” in <a href="/docs/embed">Embedding Horizon</a> for details.</p>

<h2 id="configuring-the-client-application">Configuring the client application</h2>

<p>Use <code class="highlighter-rouge">authType: 'token'</code> when initializing Horizon in your client, and then use the <code class="highlighter-rouge">authEndpoint()</code> command to retrieve the endpoint for your OAuth identity provider and redirect the user to that URL.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">horizon</span> <span class="o">=</span> <span class="nx">Horizon</span><span class="p">({</span> <span class="na">authType</span><span class="p">:</span> <span class="s1">'token'</span> <span class="p">});</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">horizon</span><span class="p">.</span><span class="nx">hasAuthToken</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">horizon</span><span class="p">.</span><span class="nx">authEndpoint</span><span class="p">(</span><span class="s1">'github'</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">endpoint</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">endpoint</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="c1">// We have a token already, do authenticated Horizon stuff here</span>
<span class="p">}</span>
</code></pre>
</div>

<p>After logging in with Github, the user will be redirected back to the root page of your application, with the JSON Web Token in the <code class="highlighter-rouge">horizon_token</code> query parameter. The Horizon client will automatically save the JWT from the redirected URL, storing it client-side in <a href="https://web.archive.org/web/20171013233348/https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage">localStorage</a> (just as with <code class="highlighter-rouge">anonymous</code> tokens). If the token is lost, the user can simply re-authenticate with the provider. User information will be stored in the <code class="highlighter-rouge">Users</code> table.</p>

<p>If an error occurs somewhere during the authentication process, the browser will be redirected back to the root of page with an error message in the query parameters.</p>

<h2 id="clearing-tokens">Clearing tokens</h2>

<p>To delete all authentication tokens from localStorage, use <code class="highlighter-rouge">clearAuthTokens()</code>.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// Note the 'H'</span>
<span class="nx">Horizon</span><span class="p">.</span><span class="nx">clearAuthTokens</span><span class="p">();</span>
</code></pre>
</div>

<h2 id="accessing-session-data">Accessing session data</h2>

<p>You can check whether a user is currently authenticated using the <a href="/api/horizon/#hasauthtoken">Horizon.hasAuthToken</a> method, and access their information with <a href="/api/horizon/#currentuser">Horizon.currentUser</a>. For more information, read about <a href="/docs/users">Users and groups</a> and <a href="/docs/permissions">Permissions and schema enforcement</a>.</p>

<h2 id="notes-about-horizons-oauth-support">Notes about Horizon’s OAuth support</h2>

<ul>
  <li>The authorization callback URL defaults to <code class="highlighter-rouge">https://&lt;hostname&gt;/horizon/&lt;servicename&gt;</code>. For Github, for instance, your callback would be <code class="highlighter-rouge">https://yourapp.com/horizon/github</code>. This can be changed with the <code class="highlighter-rouge">path</code> option to the <code class="highlighter-rouge">add_auth_provider</code> method. (See <a href="/docs/embed">Embedding Horizon</a> for details on this option.)</li>
  <li>Currently, no metadata from OAuth providers—for example, friend/following lists— can be requested. In the near future, Horizon will support authentication scopes for selected providers to request access to these details, and returned metadata will be stored in the <code class="highlighter-rouge">Users</code> table.</li>
  <li>The redirection URL will be configurable in a future release.</li>
  <li><a href="https://web.archive.org/web/20171013233348/http://passportjs.org/">Passport</a> integration is not currently on Horizon’s roadmap; this decision was made to avoid tightly coupling Horizon with <a href="https://web.archive.org/web/20171013233348/http://expressjs.com/">Express</a>. (A <a href="https://web.archive.org/web/20171013233348/https://github.com/rethinkdb/horizon/issues/new">Github issue</a> may be opened to discuss this in the future.)</li>
</ul>


        </section>
    </div>
</section>

        </section>
        <footer>
            <div class="site-container">
                <section class="about">
                    <h1 class="hz">Horizon is a <strong>realtime, open-source backend</strong> for JavaScript apps.</h1>
                    <a href="https://web.archive.org/web/20171013233348/https://github.com/rethinkdb/horizon" class="button primary-button">Star the project on GitHub</a>
                </section>
                <section class="footer-right">
                    <nav class="site-map">
                        <section>
                            <h1>Getting started</h1>
                            <ul>
                                <li><a href="/faq">FAQ</a></li>
                                <li><a href="/install">Install</a></li>
                                <li><a href="/docs/getting-started">Getting started</a></li>
                            </ul>
                        </section>
                        <section>
                            <h1>Documentation</h1>
                            <ul>
                                <li><a href="/api/collection">Collection API</li>
                                <li><a href="/api/horizon">Horizon API</a></li>
                                <li><a href="/docs/cli">Horizon CLI</a></li>
                            </ul>
                        </section>
                        <section>
                            <h1>Get involved</h1>
                            <ul>
                                <li><a href="https://web.archive.org/web/20171013233348/http://slack.rethinkdb.com/">Join us on Slack #horizon</a></li>
                                <li><a href="https://web.archive.org/web/20171013233348/https://discuss.horizon.io/">Discuss on Discourse</a></li>
                                <li><a href="https://web.archive.org/web/20171013233348/https://rethinkdb.com/community/shirts-for-stories/">Shirts for Stories</a></li>
                            </ul>
                        </section>
                    </nav>
                    <h1 class="github">Built by the <a href="https://web.archive.org/web/20171013233348/https://rethinkdb.com/">RethinkDB team</a> and an amazing community.</h2>
                </section>
            </div>
        </footer>
        <script type="text/javascript">
          var _gauges = _gauges || [];
          (function() {
            var t   = document.createElement('script');
            t.type  = 'text/javascript';
            t.async = true;
            t.id    = 'gauges-tracker';
            t.setAttribute('data-site-id', '56fb1a594b2ffa61f100a699');
            t.setAttribute('data-track-path', 'https://web.archive.org/web/20171013233348/https://track.gaug.es/track.gif');
            t.src = 'https://web.archive.org/web/20171013233348/https://d36ee2fcip1434.cloudfront.net/track.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(t, s);
          })();
        </script>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//web.archive.org/web/20171013233348/http://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-9922584-3', 'auto');
          ga('send', 'pageview');

      </script>
    </body>
</html>
<!--
     FILE ARCHIVED ON 23:33:48 Oct 13, 2017 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 18:47:29 Apr 21, 2018.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  LoadShardBlock: 132.052 (3)
  esindex: 0.006
  captures_list: 196.228
  CDXLines.iter: 10.402 (3)
  PetaboxLoader3.datanode: 200.367 (5)
  exclusion.robots: 0.234
  exclusion.robots.policy: 0.21
  RedisCDXSource: 49.523
  PetaboxLoader3.resolve: 59.741
  load_resource: 148.375 (2)
-->
