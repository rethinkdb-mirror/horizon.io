<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Getting started with Horizon</title>

        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="/css/github.css">

        <link rel="icon" type="image/png" href="/favicon/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/favicon/favicon-96x96.png" sizes="96x96">
        <link rel="icon" type="image/png" href="/favicon/favicon-16x16.png" sizes="16x16">
        <link rel="shortcut icon" href="/favicon/favicon.ico">

        <!-- fonts.com -->
        <script type="text/javascript">
            // first, create the object that contains
            // configuration variables
            MTIConfig = {};

            // next, add a variable that will control
            // whether or not FOUT will be prevented
            MTIConfig.EnableCustomFOUTHandler = false // true = prevent FOUT
        </script>
        <script type="text/javascript" src="//fast.fonts.net/jsapi/5cf5064a-b80d-4123-82d3-5c7a863edb22.js"></script>
        <!-- jquery -->
        <script type="text/javascript" src="/js/jquery/jquery-2.2.3.min.js"></script>
        <!-- waypoints -->
        <script type="text/javascript" src="/js/waypoints/jquery.waypoints.min.js"></script>
        <script type="text/javascript" src="/js/waypoints/sticky.min.js"></script>
        <!-- horizon.io -->
        <script type="text/javascript" src="/js/site.js"></script>
    </head>
    <body>
        

        <nav class="site-nav">
            <div class="site-container">
                <a class="logo" href="/"><img src="/images/horizon-logo.png" alt="Horizon"></a>
                <ul class="navbar-links">
                    <li class="menu-trigger">
                        <svg height="24px" version="1.1" viewBox="0 0 24 24" width="24px" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns" xmlns:xlink="http://www.w3.org/1999/xlink"><title/><desc/><defs/><g fill="none" fill-rule="evenodd" id="miu" stroke="none" stroke-width="1"><g id="Artboard-1" transform="translate(-395.000000, -479.000000)"><g id="slice" transform="translate(215.000000, 119.000000)"/><path d="M396.500836,485 C396.224232,485 396,485.214035 396,485.504684 L396,486.495316 C396,486.774045 396.217742,487 396.500836,487 L417.499164,487 C417.775768,487 418,486.785965 418,486.495316 L418,485.504684 C418,485.225955 417.782258,485 417.499164,485 L396.500836,485 Z M396.500836,490 C396.224232,490 396,490.214035 396,490.504684 L396,491.495316 C396,491.774045 396.217742,492 396.500836,492 L417.499164,492 C417.775768,492 418,491.785965 418,491.495316 L418,490.504684 C418,490.225955 417.782258,490 417.499164,490 L396.500836,490 Z M396.500836,495 C396.224232,495 396,495.214035 396,495.504684 L396,496.495316 C396,496.774045 396.217742,497 396.500836,497 L417.499164,497 C417.775768,497 418,496.785965 418,496.495316 L418,495.504684 C418,495.225955 417.782258,495 417.499164,495 L396.500836,495 Z" id="editor-list-view-hambuger-menu-glyph"/></g></g></svg>

                    </li>
                    <li>
                        <a href="/cloud">Horizon Cloud</a>
                    </li>
                    <li>
                        <a href="/install">Install</a>
                    </li>
                    <li>
                        <a href="/faq">FAQ</a>
                    </li>
                    <li class="active">
                        <a href="/docs">Docs</a>
                    </li>
                    <li>
                        <a href="/community">Community</a>
                    </li>
                    <li>
                        <a href="/blog">Blog</a>
                    </li>
                </ul>
            </div>
        </nav>
        <section class="site-content">
            <section class="documentation">
    <div class="site-container">
        <nav class="docs-nav">
            
            <section>
                <h1>Horizon basics</h1>
                <ul>
                    
                        <li>
                            <!-- index | getting-started -->
                            <a href="/docs">Overview</a>
                        </li>
                    
                        <li>
                            <!-- install | getting-started -->
                            <a href="/install">Install Horizon</a>
                        </li>
                    
                        <li>
                            <!-- faq | getting-started -->
                            <a href="/faq">FAQ</a>
                        </li>
                    
                        <li class="active">
                            <!-- getting-started | getting-started -->
                            <a href="/docs/getting-started">Getting started</a>
                        </li>
                    
                </ul>
            </section>
            
            <section>
                <h1>Building Horizon apps</h1>
                <ul>
                    
                        <li>
                            <!-- cli | getting-started -->
                            <a href="/docs/cli">Horizon CLI</a>
                        </li>
                    
                        <li>
                            <!-- auth | getting-started -->
                            <a href="/docs/auth">Authentication</a>
                        </li>
                    
                        <li>
                            <!-- users | getting-started -->
                            <a href="/docs/users">Users and groups</a>
                        </li>
                    
                        <li>
                            <!-- permissions | getting-started -->
                            <a href="/docs/permissions">Permissions</a>
                        </li>
                    
                        <li>
                            <!-- api-collection | getting-started -->
                            <a href="/api/collection">Collection API</a>
                        </li>
                    
                        <li>
                            <!-- api-horizon | getting-started -->
                            <a href="/api/horizon">Horizon API</a>
                        </li>
                    
                </ul>
            </section>
            
            <section>
                <h1>Resources</h1>
                <ul>
                    
                        <li>
                            <!-- config | getting-started -->
                            <a href="/docs/configuration">Configuring Horizon</a>
                        </li>
                    
                        <li>
                            <!-- embed | getting-started -->
                            <a href="/docs/embed">Embedding Horizon</a>
                        </li>
                    
                        <li>
                            <!-- examples | getting-started -->
                            <a href="/docs/examples">Example apps</a>
                        </li>
                    
                        <li>
                            <!-- limitations | getting-started -->
                            <a href="/docs/limitations">Limitations</a>
                        </li>
                    
                        <li>
                            <!-- docker | getting-started -->
                            <a href="/docs/docker">Horizon with Docker</a>
                        </li>
                    
                </ul>
            </section>
            
        </nav>
        <section class="docs-article document">
            
                <img src="/images/docs/getting-started.png">
            
            <h1 class="title">Getting started with Horizon</h1>
            <p>If you haven’t installed Horizon, do so now. (Read the <a href="/install">Installation instructions</a> for more details.)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>npm install -g horizon
</code></pre>
</div>

<ul id="markdown-toc">
  <li><a href="#using-the-horizon-cli" id="markdown-toc-using-the-horizon-cli">Using the Horizon CLI</a></li>
  <li><a href="#initialize-an-example-application" id="markdown-toc-initialize-an-example-application">Initialize an example application</a></li>
  <li><a href="#start-the-server" id="markdown-toc-start-the-server">Start the server</a></li>
  <li><a href="#talk-to-horizon" id="markdown-toc-talk-to-horizon">Talk to Horizon</a></li>
  <li><a href="#horizon-collections" id="markdown-toc-horizon-collections">Horizon Collections</a></li>
  <li><a href="#removing-documents" id="markdown-toc-removing-documents">Removing documents</a></li>
  <li><a href="#watching-for-changes" id="markdown-toc-watching-for-changes">Watching for changes</a></li>
  <li><a href="#putting-it-all-together" id="markdown-toc-putting-it-all-together">Putting it all together</a></li>
  <li><a href="#integrating-horizon-with-an-existing-application" id="markdown-toc-integrating-horizon-with-an-existing-application">Integrating Horizon with an existing application</a></li>
  <li><a href="#further-reading" id="markdown-toc-further-reading">Further reading</a></li>
</ul>

<h2 id="using-the-horizon-cli">Using the Horizon CLI</h2>

<p>Interactions with Horizon are performed with the <code class="highlighter-rouge">hz</code> application. <code class="highlighter-rouge">hz</code> has a number of commands, of which we are going to use the following two:</p>

<ul>
  <li><code class="highlighter-rouge">init [directory]</code>: initialize a new Horizon application</li>
  <li><code class="highlighter-rouge">serve</code>: serve the project in the current directory</li>
</ul>

<h2 id="initialize-an-example-application">Initialize an example application</h2>

<p>Let’s create a new Horizon application. Go to a directory you’d like to install this application into and type:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hz init example_app
</code></pre>
</div>

<p>This will create the <code class="highlighter-rouge">example_app</code> directory and install a few files into it. (If you run <code class="highlighter-rouge">hz init</code> without giving it a directory, it will install these files into the current directory.)</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ tree example_app
example_app/
├── .hz
│   ├── config.toml
│   ├── schema.toml
│   └── secrets.toml
├── dist
│   └── index.html
└── src
</code></pre>
</div>
<p>Here’s what these files and directories are:</p>

<ul>
  <li><code class="highlighter-rouge">dist</code> is for static files. You can create files directly here, or use it as the output directory for a build system of your choice.</li>
  <li><code class="highlighter-rouge">src</code> is for source files for your build system. This isn’t a convention you have to follow; Horizon doesn’t touch anything in this directory.</li>
  <li><code class="highlighter-rouge">dist/index.html</code> is a sample file. You’ll replace this as you develop your application, but there’s enough in it to verify that Horizon is installed and working.</li>
  <li><code class="highlighter-rouge">.hz/config.toml</code> is a <a href="https://github.com/toml-lang/toml">TOML</a> configuration file for the Horizon server.</li>
  <li><code class="highlighter-rouge">.hz/schema.toml</code> is the default schema file. This creates one group, <code class="highlighter-rouge">admin</code>, and a ruleset for that group, <code class="highlighter-rouge">carte_blanche</code>, allowing members to execute any query. (By default <em>only</em> this group has database access in production! Read <a href="/docs/permissions">permissions</a> for more details.)</li>
  <li><code class="highlighter-rouge">.hz/secrets.toml</code> stores authentication options for the application.</li>
</ul>

<p><strong>Note:</strong> In Horizon 1.x, authentication options were stored in <code class="highlighter-rouge">config.toml</code>.</p>

<h2 id="start-the-server">Start the server</h2>

<p>Start Horizon to test it out:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>hz serve --dev
</code></pre>
</div>

<p>You’ll see a series of output messages as Horizon starts a RethinkDB server, ending with <code class="highlighter-rouge">Metadata synced with server, ready for queries.</code> Now, go to <a href="http://localhost:8181">http://localhost:8181</a>. You should see the message “App works!” scrolling across your screen.</p>

<p>Here’s what <code class="highlighter-rouge">hz serve</code> actually does:</p>

<ul>
  <li>Start the Horizon API server, a Node.js application.</li>
  <li>Starts an HTTP server which serves the Horizon client library, <code class="highlighter-rouge">horizon.js</code>.</li>
</ul>

<p>Passing the <code class="highlighter-rouge">--dev</code> flag to <code class="highlighter-rouge">hz serve</code> puts it in development mode, which makes the following changes. (All of these can also be set individually with separate flags to <code class="highlighter-rouge">serve</code>.)</p>

<ul>
  <li>A RethinkDB server is automatically started (<code class="highlighter-rouge">--start-rethinkdb</code>). This server is specifically for this Horizon application, and will create a <code class="highlighter-rouge">rethinkdb_data</code> folder in the working directory when started.</li>
  <li>Horizon is served in “insecure mode,” without requiring SSL/TLS (<code class="highlighter-rouge">--secure no</code>).</li>
  <li>The permissions system is disabled (<code class="highlighter-rouge">--permissions no</code>).</li>
  <li>Tables and indexes will automatically be created if they don’t exist (<code class="highlighter-rouge">--auto-create-collection</code> and <code class="highlighter-rouge">--auto-create-index</code>).</li>
  <li>Static files will be served from the <code class="highlighter-rouge">dist</code> directory (<code class="highlighter-rouge">--serve-static ./dist</code>).</li>
</ul>

<p>You can find the complete list of <a href="/docs/cli">command line flags</a> for <code class="highlighter-rouge">hz serve</code> in the documentation for the <a href="/docs/cli">Horizon CLI</a>.</p>

<p>In production (i.e., without the <code class="highlighter-rouge">--dev</code> flag), you’ll use the <code class="highlighter-rouge">.hz/config.toml</code> file to set these and other options. See <a href="/docs/configuration">Configuring Horizon</a> for details.</p>

<h2 id="talk-to-horizon">Talk to Horizon</h2>

<p>Load the <code class="highlighter-rouge">index.html</code> file in <code class="highlighter-rouge">example_app</code>. It’s pretty short:</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!doctype html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/horizon/horizon.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
      <span class="kd">var</span> <span class="nx">horizon</span> <span class="o">=</span> <span class="nx">Horizon</span><span class="p">();</span>
      <span class="nx">horizon</span><span class="p">.</span><span class="nx">onReady</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="s1">'h1'</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">'App works!'</span>
      <span class="p">});</span>
      <span class="nx">horizon</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
    <span class="nt">&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
   <span class="nt">&lt;marquee&gt;&lt;h1&gt;&lt;/h1&gt;&lt;/marquee&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p>The two <code class="highlighter-rouge">script</code> tags do the work here. The first loads the actual Horizon client library, <code class="highlighter-rouge">horizon.js</code>; the second is a (very tiny) Horizon application:</p>

<ul>
  <li><code class="highlighter-rouge">var horizon = Horizon()</code> instantiates a <a href="/api/horizon">Horizon</a> object. This object only has a few methods on it, for handling connection-related events and for instantiating Horizon <a href="/api/collection">Collections</a>.</li>
  <li><a href="/api/horizon/#onready">onReady</a> is an event handler that’s executed when the client makes a successful connection to the server.</li>
  <li>Our connection function simply fills in <code class="highlighter-rouge">"App works!"</code> into the <code class="highlighter-rouge">&lt;h1&gt;</code> tag in the document. Since this function only gets executed on a successful connection, it <em>does</em> verify that Horizon is working, but it’s not leveraging RethinkDB for anything yet.</li>
  <li>Also, we’re sorry for the <code class="highlighter-rouge">&lt;marquee&gt;</code> tag.</li>
</ul>

<h2 id="horizon-collections">Horizon Collections</h2>

<p>The heart of Horizon is the <code class="highlighter-rouge">Collection</code> object, which lets you store, retrieve, and filter documents. Many <code class="highlighter-rouge">Collection</code> methods for reading and writing documents return <a href="http://reactivex.io/rxjs/">RxJS</a> Observables.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// Create a "messages" collection</span>
<span class="kr">const</span> <span class="nx">chat</span> <span class="o">=</span> <span class="nx">horizon</span><span class="p">(</span><span class="s2">"messages"</span><span class="p">);</span>
</code></pre>
</div>

<p>To store documents in the collection, use <a href="/api/collection/#store">store</a>.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">text</span><span class="p">:</span> <span class="s2">"What a beautiful horizon!"</span><span class="p">,</span>
  <span class="na">datetime</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span>
  <span class="na">author</span><span class="p">:</span> <span class="s2">"@dalanmiller"</span>
<span class="p">}</span>

<span class="nx">chat</span><span class="p">.</span><span class="nx">store</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>
</code></pre>
</div>

<p>To retrieve documents, use <a href="/api/collection/#fetch">fetch</a>.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="nx">chat</span><span class="p">.</span><span class="nx">fetch</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">(</span>
  <span class="p">(</span><span class="nx">items</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">items</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// Each result from the chat collection</span>
      <span class="c1">//  will pass through this function</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
    <span class="p">})</span>
  <span class="p">},</span>
  <span class="c1">// If an error occurs, this function</span>
  <span class="c1">//  will execute with the `err` message</span>
  <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">})</span>
</code></pre>
</div>

<p>We use the RxJS <a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html#instance-method-subscribe">subscribe</a> method to receive items from the collection, as well as to provide an error handler.</p>

<h2 id="removing-documents">Removing documents</h2>

<p>To remove documents from a collection, use either <a href="/api/collection/#remove">remove</a> or <a href="/api/collection/#removeall">removeAll</a>.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// These two queries are equivalent and will remove the document with id: 1</span>
<span class="nx">chat</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">})</span>
<span class="nx">chat</span><span class="p">.</span><span class="nx">remove</span><span class="p">({</span><span class="na">id</span><span class="p">:</span> <span class="mi">1</span><span class="p">}).</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">id</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">id</span><span class="p">)})</span>

<span class="c1">// Will remove documents with ids 1, 2, and 3 from the collection</span>
<span class="nx">chat</span><span class="p">.</span><span class="nx">removeAll</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
</code></pre>
</div>

<p>As with the other functions, you can chain <code class="highlighter-rouge">subscribe</code> onto the remove functions to provide response and error handlers.</p>

<h2 id="watching-for-changes">Watching for changes</h2>

<p>We can “listen” to an entire collection, query, or a single document by using <a href="/api/collection/#watch">watch</a>. This lets us build apps that update state immediately as data changes in the database.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="c1">// Watch all documents. If any of them change, call the handler function.</span>
<span class="nx">chat</span><span class="p">.</span><span class="nx">watch</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">docs</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">docs</span><span class="p">)</span>  <span class="p">})</span>

<span class="c1">// Query all documents and sort them in ascending order by datetime,</span>
<span class="c1">//  then if any of them change, the handler function is called.</span>
<span class="nx">chat</span><span class="p">.</span><span class="nx">order</span><span class="p">(</span><span class="s2">"datetime"</span><span class="p">).</span><span class="nx">watch</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">docs</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">docs</span><span class="p">)</span>  <span class="p">})</span>

<span class="c1">// Watch a single document in the collection.</span>
<span class="nx">chat</span><span class="p">.</span><span class="nx">find</span><span class="p">({</span><span class="na">author</span><span class="p">:</span> <span class="s2">"@dalanmiller"</span><span class="p">}).</span><span class="nx">watch</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">((</span><span class="nx">doc</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">doc</span><span class="p">)</span> <span class="p">})</span>
</code></pre>
</div>

<p>By default, the Observable returned from <code class="highlighter-rouge">watch</code> receives the entire collection of documents when a single one changes. This makes it easy to use frameworks such as <a href="https://vuejs.org/">Vue</a> or <a href="https://facebook.github.io/react/">React</a>, allowing you to simply replace your existing copy of the collection with the new array returned by Horizon.</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">chats</span> <span class="o">=</span> <span class="p">[];</span>

<span class="c1">// Query chats with `.order`, which by default is in ascending order</span>
<span class="nx">chat</span><span class="p">.</span><span class="nx">order</span><span class="p">(</span><span class="s2">"datetime"</span><span class="p">).</span><span class="nx">watch</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">(</span>

  <span class="c1">// Returns the entire array</span>
  <span class="p">(</span><span class="nx">newChats</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

    <span class="c1">// Here we replace the old value of `chats` with the new</span>
    <span class="c1">//  array. Frameworks such as React will re-render based</span>
    <span class="c1">//  on the new values inserted into the array.</span>
    <span class="nx">chats</span> <span class="o">=</span> <span class="nx">newChats</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
  <span class="p">})</span>
</code></pre>
</div>

<p>To learn more about how Horizon works with React, check out the <a href="/docs/examples">complete Horizon &amp; React example</a>.</p>

<h2 id="putting-it-all-together">Putting it all together</h2>

<p>Now that we have the basics covered, let’s pretend we’re building a simple chat application where the messages are displayed in ascending order. We now have to get a little opinionated and choose a front-end framework. For the purposes of this quick demo, we’ll use Vue.js.</p>

<p>The first step is to initialize our Horizon app directory:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>hz init chat-app
Created new project directory chat-app
Created chat-app/src directory
Created chat-app/dist directory
Created chat-app/dist/index.html example
Created chat-app/.hz directory
Created chat-app/.hz/config.toml
</code></pre>
</div>

<p>Now, we’ll <code class="highlighter-rouge">cd</code> into the <code class="highlighter-rouge">chat-app</code> directory and start putting files into <code class="highlighter-rouge">dist</code>, the automatically-created static file directory. All files in here will be served by default in Horizon.</p>

<p>Let’s start first with <code class="highlighter-rouge">app.js</code>. The key parts here are listening to the stream of chat messages with a <code class="highlighter-rouge">.watch()</code> query, as well as being able to input a new message with the <code class="highlighter-rouge">.store()</code> query. Here’s what your <code class="highlighter-rouge">app.js</code> should look like:</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">const</span> <span class="nx">horizon</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Horizon</span><span class="p">()</span>
<span class="kr">const</span> <span class="nx">messages</span> <span class="o">=</span> <span class="nx">horizon</span><span class="p">(</span><span class="s1">'messages'</span><span class="p">)</span>

<span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
  <span class="na">el</span><span class="p">:</span> <span class="s1">'#app'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="err">`</span>
    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"chatMessages"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">ul</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="nx">li</span> <span class="nx">v</span><span class="o">-</span><span class="k">for</span><span class="o">=</span><span class="s2">"message in messages"</span><span class="o">&gt;</span>
            <span class="p">{{</span> <span class="nx">message</span><span class="p">.</span><span class="nx">text</span> <span class="p">}}</span>
          <span class="o">&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>        <span class="o">&lt;</span><span class="sr">/ul</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">"input"</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">input</span> <span class="err">@</span><span class="nx">keyup</span><span class="p">.</span><span class="nx">enter</span><span class="o">=</span><span class="s2">"sendMessage"</span> <span class="o">&gt;&lt;</span><span class="sr">/input</span><span class="err">&gt;
</span>      <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span>  <span class="err">`</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// Our dynamic list of chat messages</span>
    <span class="na">messages</span><span class="p">:</span> <span class="p">[]</span>
  <span class="p">},</span>
  <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Subscribe to messages</span>
    <span class="nx">messages</span><span class="p">.</span><span class="nx">order</span><span class="p">(</span><span class="s1">'datetime'</span><span class="p">,</span> <span class="s1">'descending'</span><span class="p">).</span><span class="nx">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">).</span><span class="nx">watch</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="nx">allMessages</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="c1">// Make a copy of the array and reverse it, so newest images push into</span>
        <span class="c1">// the messages feed from the bottom of the rendered list. (Otherwise</span>
        <span class="c1">// they appear initially at the top and move down)</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">allMessages</span><span class="p">].</span><span class="nx">reverse</span><span class="p">()</span>
      <span class="p">},</span>
      <span class="c1">// When error occurs on server</span>
      <span class="nx">error</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1">// Triggers when client successfully connects to server</span>
    <span class="nx">horizon</span><span class="p">.</span><span class="nx">onReady</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">(</span>
      <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Connected to Horizon server"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1">// Triggers when disconnected from server</span>
    <span class="nx">horizon</span><span class="p">.</span><span class="nx">onDisconnected</span><span class="p">().</span><span class="nx">subscribe</span><span class="p">(</span>
      <span class="p">()</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Disconnected from Horizon server"</span><span class="p">)</span>
    <span class="p">)</span>
  <span class="p">},</span>
  <span class="nx">methods</span><span class="err">:</span> <span class="p">{</span>
    <span class="nx">sendMessage</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">messages</span><span class="p">.</span><span class="nx">store</span><span class="p">({</span>
        <span class="na">text</span><span class="p">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span> <span class="c1">// Current value inside &lt;input&gt; tag</span>
        <span class="na">datetime</span><span class="p">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="c1">// Warning clock skew!</span>
      <span class="p">}).</span><span class="nx">subscribe</span><span class="p">(</span>
          <span class="c1">// Returns id of saved objects</span>
          <span class="nx">result</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">),</span>
          <span class="c1">// Returns server error message</span>
          <span class="nx">error</span> <span class="o">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="c1">// Clear input for next message</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="s1">''</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>
</div>

<p>Now, we’ll need to replace the boilerplate in the <code class="highlighter-rouge">index.html</code> file with code that loads Horizon, Vue.js, and our application.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/horizon/horizon.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"app"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/vue/1.0.25/vue.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span> <span class="na">src=</span><span class="s">"/app.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre>
</div>

<p>So your app directory should look like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>chat-app
├── .hz
│   └── config.toml
├── dist
│   ├── app.js
│   ├── index.html
└── src
</code></pre>
</div>

<p>You can now run <code class="highlighter-rouge">hz serve --dev</code> and load your working chat application at <a href="http://localhost:8181">http://localhost:8181</a>. Open it in multiple browser tabs to watch the application update instantly!</p>

<p>From here, you could take any framework and add these functions to create a realtime chat application without writing a single line of backend code!</p>

<h2 id="integrating-horizon-with-an-existing-application">Integrating Horizon with an existing application</h2>

<p>While Horizon serves static files from the <code class="highlighter-rouge">dist</code> folder by default, you can use any method to serve your files. You have two options to include the Horizon client library:</p>

<ul>
  <li>Use <code class="highlighter-rouge">horizon.js</code> served by the Horizon server</li>
  <li>Install <code class="highlighter-rouge">@horizon/client</code> as a dependency in your project</li>
</ul>

<p>We recommend the first option, as that will prevent any possibly mismatches between the client library version and the Horizon server. In your application, you’ll need to include the Horizon client file, and specify the Horizon port number when initializing the connection.</p>

<div class="language-html highlighter-rouge"><pre class="highlight"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"/horizon/horizon.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="c1">// Specify the host property for initializing the Horizon connection</span>
<span class="kr">const</span> <span class="nx">horizon</span> <span class="o">=</span> <span class="nx">Horizon</span><span class="p">({</span><span class="na">host</span><span class="p">:</span> <span class="s1">'localhost:8181'</span><span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>
</div>

<p>However, if you’re using <a href="https://webpack.github.io/">Webpack</a> or a similar build setup, or requesting the <code class="highlighter-rouge">.js</code> library at load time isn’t desirable, just add the client library as an NPM dependency (<code class="highlighter-rouge">npm install @horizon/client</code>).</p>

<div class="language-js highlighter-rouge"><pre class="highlight"><code><span class="kr">import</span> <span class="nx">Horizon</span> <span class="nx">from</span> <span class="s1">'@horizon/client'</span><span class="p">;</span>

<span class="c1">// Specify the host property for initializing the Horizon connection</span>
<span class="kr">const</span> <span class="nx">horizon</span> <span class="o">=</span> <span class="nx">Horizon</span><span class="p">({</span><span class="na">host</span><span class="p">:</span> <span class="s1">'localhost:8181'</span><span class="p">});</span>
</code></pre>
</div>

<h2 id="further-reading">Further reading</h2>

<ul>
  <li>Read about <a href="/docs/auth">Authentication</a>, including easy integration with OAuth providers such as Twitter and Github.</li>
  <li>Read about Horizon’s <a href="/docs/permissions">Permissions</a> and schema enforcement.</li>
  <li>Read the <a href="/api/collection">Collection</a> and <a href="/api/horizon">Horizon</a> API documentation.</li>
  <li>The <a href="/docs/examples">Horizon sample apps</a> can show you how to integrate Horizon with popular frameworks such as React and Angular.</li>
</ul>


        </section>
    </div>
</section>

        </section>
        <footer>
            <div class="site-container">
                <section class="about">
                    <h1 class="hz">Horizon is a <strong>realtime, open-source backend</strong> for JavaScript apps.</h1>
                    <a href="https://github.com/rethinkdb/horizon" class="button primary-button">Star the project on GitHub</a>
                </section>
                <section class="footer-right">
                    <nav class="site-map">
                        <section>
                            <h1>Getting started</h1>
                            <ul>
                                <li><a href="/faq">FAQ</a></li>
                                <li><a href="/install">Install</a></li>
                                <li><a href="/docs/getting-started">Getting started</a></li>
                            </ul>
                        </section>
                        <section>
                            <h1>Documentation</h1>
                            <ul>
                                <li><a href="/api/collection">Collection API</li>
                                <li><a href="/api/horizon">Horizon API</a></li>
                                <li><a href="/docs/cli">Horizon CLI</a></li>
                            </ul>
                        </section>
                        <section>
                            <h1>Get involved</h1>
                            <ul>
                                <li><a href="http://slack.rethinkdb.com">Join us on Slack #horizon</a></li>
                                <li><a href="https://discuss.horizon.io">Discuss on Discourse</a></li>
                                <li><a href="https://rethinkdb.com/community/shirts-for-stories/">Shirts for Stories</a></li>
                            </ul>
                        </section>
                    </nav>
                    <h1 class="github">Built by the <a href="https://rethinkdb.com">RethinkDB team</a> and an amazing community.</h2>
                </section>
            </div>
        </footer>
        <script type="text/javascript">
          var _gauges = _gauges || [];
          (function() {
            var t   = document.createElement('script');
            t.type  = 'text/javascript';
            t.async = true;
            t.id    = 'gauges-tracker';
            t.setAttribute('data-site-id', '56fb1a594b2ffa61f100a699');
            t.setAttribute('data-track-path', 'https://track.gaug.es/track.gif');
            t.src = 'https://d36ee2fcip1434.cloudfront.net/track.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(t, s);
          })();
        </script>
        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-9922584-3', 'auto');
          ga('send', 'pageview');

      </script>
    </body>
</html>
